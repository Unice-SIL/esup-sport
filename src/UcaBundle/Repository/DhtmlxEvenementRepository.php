<?php

namespace UcaBundle\Repository;

use UcaBundle\Entity\FormatAvecCreneau;

/**
 * ActiviteRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class DhtmlxEvenementRepository extends \Doctrine\ORM\EntityRepository
{
    public function findDhtmlxDateByReference($type, $id)
    {
        if ($type == "ressource") {
            return $this->createQueryBuilder("e")
                ->leftJoin("e.reservabilite", "re")
                ->leftJoin("re.ressource", "r")
                ->where("r.id = :id")
                ->andWhere("e.serie is null")
                ->setParameter("id", $id)
                ->getQuery()
                ->getResult(); 
        }
        elseif ($type == "FormatActivite") {
            /* tous les Ã©venements pour le type FormatActivite font partie d'une serie */
        }
    }
    
    public function findByDhtmlxDateByWeek($idRessource, $YearWeek){
        $dateA = new \DateTime($YearWeek);
        $dateB = new \DateTime($YearWeek);
        $dateB = $dateB->modify("+7 day");
        $data = $this->createQueryBuilder("e")
        ->leftJoin("e.reservabilite", "re")
        ->leftJoin("re.ressource", "r")
        ->where("r.id = :id")
        ->andWhere("e.serie is null")
        ->andWhere("e.dateDebut BETWEEN :dateA and :dateB")
        ->orderBy("e.dateDebut")
        ->setParameter("id", $idRessource)
        ->setParameter("dateA", $dateA)
        ->setParameter("dateB", $dateB)
        ->getQuery()
        ->getResult(); 
    
        return $data;
    }
}
